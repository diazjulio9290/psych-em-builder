<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="robots" content="noindex, nofollow" />
  <title>Psych E&M Note Builder - Time Itemized</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0c1017; --surface: rgba(255,255,255,0.04); --surface2: rgba(255,255,255,0.065);
      --surface3: rgba(255,255,255,0.09); --border: rgba(255,255,255,0.08); --border2: rgba(255,255,255,0.12);
      --text: #e8eaf0; --text2: rgba(255,255,255,0.68); --text3: rgba(255,255,255,0.45);
      --blue: #5b8def; --blue-glow: rgba(91,141,239,0.15); --violet: #a78bfa;
      --violet-glow: rgba(167,139,250,0.12); --green: #34d399; --green-dim: rgba(52,211,153,0.14);
      --amber: #fbbf24; --amber-dim: rgba(251,191,36,0.12); --red: #f87171; --red-dim: rgba(248,113,113,0.12);
      --code-bg: rgba(0,0,0,0.35); --shadow: 0 1px 2px rgba(0,0,0,0.3), 0 8px 32px rgba(0,0,0,0.25);
      --r: 14px; --r2: 10px; --font: 'DM Sans', system-ui, sans-serif; --mono: 'JetBrains Mono', monospace;
    }
    html[data-theme="light"] {
      --bg: #f4f5f7; --surface: rgba(255,255,255,0.85); --surface2: rgba(255,255,255,0.95);
      --surface3: #ffffff; --border: rgba(0,0,0,0.07); --border2: rgba(0,0,0,0.11);
      --text: #1a1d25; --text2: rgba(26,29,37,0.58); --text3: rgba(26,29,37,0.38);
      --blue: #3b6fd8; --blue-glow: rgba(59,111,216,0.08); --violet: #7c5cc4;
      --green: #16a368; --green-dim: rgba(22,163,104,0.10); --amber: #d97706; --amber-dim: rgba(217,119,6,0.08);
      --red: #dc2626; --red-dim: rgba(220,38,38,0.07); --code-bg: #f0f2f5;
    }
    * { box-sizing: border-box; margin: 0; }
    body { font-family: var(--font); background: var(--bg); color: var(--text); min-height: 100vh; }
    .shell { max-width: 1200px; margin: 0 auto; padding: 20px 16px 48px; }
    
    .topbar { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: var(--surface2); border: 1px solid var(--border); border-radius: var(--r); }
    .brand-title { font-size: 15px; font-weight: 600; }
    .brand-sub { font-size: 12px; color: var(--text2); }
    .btn { padding: 8px 12px; border-radius: var(--r2); border: 1px solid var(--border2); background: var(--surface2); color: var(--text); font-size: 12.5px; cursor: pointer; }
    .btn:hover { background: var(--surface3); }
    .btn-primary { background: linear-gradient(135deg, var(--blue), var(--violet)); color: #fff; border: none; }
    
    .grid { margin-top: 16px; display: grid; grid-template-columns: 1.15fr 0.85fr; gap: 14px; align-items: start; }
    @media (max-width: 980px) { .grid { grid-template-columns: 1fr; } }
    
    .card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--r); overflow: hidden; }
    .card-head { padding: 14px 16px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px;}
    .card-head h2 { font-size: 14px; font-weight: 600; }
    .card-body { padding: 14px 16px 18px; }
    
    .row2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }
    .field { display: flex; flex-direction: column; gap: 6px; padding: 10px 12px; border-radius: var(--r2); background: var(--surface2); border: 1px solid var(--border); }
    .field-label { font-size: 11px; color: var(--text2); font-weight: 500; text-transform: uppercase; }
    select, input[type="number"] { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid var(--border2); background: var(--code-bg); color: var(--text); font-size: 13px; }
    
    /* Time Breakdown Section */
    .time-breakdown { display: none; background: var(--blue-glow); border: 1px solid var(--blue); padding: 12px; border-radius: var(--r2); margin-bottom: 14px; }
    .time-breakdown.active { display: block; }
    .time-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
    .time-item { display: flex; align-items: center; justify-content: space-between; font-size: 12px; }
    .time-item input { width: 60px; padding: 4px 8px; text-align: right;}
    .total-time-display { margin-top: 10px; font-weight: bold; font-size: 14px; text-align: right; color: var(--blue); }

    .groups { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .group { padding: 12px; border-radius: var(--r2); background: var(--surface2); border: 1px solid var(--border); }
    .group h3 { font-size: 11.5px; font-weight: 600; text-transform: uppercase; color: var(--text2); margin-bottom: 8px; border-bottom: 1px solid var(--border); padding-bottom: 4px; }
    .check { display: flex; gap: 9px; padding: 4px 0; cursor: pointer; }
    .check input { width: 16px; height: 16px; accent-color: var(--blue); }
    .check-text { font-size: 13px; }

    .score-card { padding: 14px; border-radius: var(--r2); background: var(--surface2); border: 1px solid var(--border); margin-bottom: 14px; }
    .score-code { font-size: 26px; font-weight: 700; font-family: var(--mono); color: var(--blue); }
    
    .note-box { border-radius: var(--r2); border: 1px solid var(--border); background: var(--code-bg); }
    .note-head { padding: 8px 12px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-size: 11px; background: var(--surface); }
    pre { padding: 12px; white-space: pre-wrap; font-family: var(--mono); font-size: 12px; line-height: 1.5; color: var(--text); }
  </style>
</head>
<body>
  <div class="shell">
    <header class="topbar">
      <div>
        <div class="brand-title">Psych E&amp;M Note Builder</div>
        <div class="brand-sub">Itemized Time &amp; MDM Billing Automation</div>
      </div>
      <div>
        <button class="btn" id="btnTheme">Toggle Theme</button>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <div class="card-head">
          <h2>Encounter Details</h2>
          <button class="btn btn-primary" id="btnToggleTime">Switch to Time-Based Billing</button>
        </div>
        <div class="card-body">
          
          <div class="time-breakdown" id="timeSection">
            <h3 style="font-size: 13px; margin-bottom: 4px;">Itemized Time Breakdown (Minutes)</h3>
            <p style="font-size: 11px; color: var(--text2);">Enter exact minutes spent on the calendar day to generate an audit-proof note.</p>
            <div class="time-grid">
              <div class="time-item"><span>Chart Review / Prep:</span> <input type="number" id="tPrep" min="0" value="0"></div>
              <div class="time-item"><span>Face-to-Face / Counseling:</span> <input type="number" id="tFace" min="0" value="0"></div>
              <div class="time-item"><span>Ordering Meds / Tests:</span> <input type="number" id="tOrder" min="0" value="0"></div>
              <div class="time-item"><span>Charting / Coordination:</span> <input type="number" id="tDoc" min="0" value="0"></div>
            </div>
            <div class="total-time-display">Total: <span id="totalTimeNum">0</span> mins</div>
          </div>

          <div id="mdmSection">
            <p style="font-size: 12px; color: var(--text2); margin-bottom: 10px;">Select elements to calculate MDM severity.</p>
            <div class="groups">
              <div class="group">
                <h3>Problems Addressed</h3>
                <label class="check"><input type="checkbox" id="p1"><span class="check-text">1 stable condition</span></label>
                <label class="check"><input type="checkbox" id="p2"><span class="check-text">2+ stable conditions</span></label>
                <label class="check"><input type="checkbox" id="p3"><span class="check-text">1 condition worsening</span></label>
              </div>
              <div class="group">
                <h3>Risk & Management</h3>
                <label class="check"><input type="checkbox" id="r1"><span class="check-text">Rx drug management</span></label>
                <label class="check"><input type="checkbox" id="r2"><span class="check-text">Safety risk assessed</span></label>
                <label class="check"><input type="checkbox" id="r3"><span class="check-text">Side effects reviewed</span></label>
              </div>
            </div>
          </div>
          
        </div>
      </div>

      <div class="card">
        <div class="card-head"><h2>Suggested Code &amp; Documentation</h2></div>
        <div class="card-body">
          <div class="score-card">
            <div style="font-size: 11px; text-transform: uppercase; color: var(--text2);">Suggested Code</div>
            <div class="score-code" id="suggestedCode">99212</div>
            <div id="codeReason" style="font-size: 12px; margin-top: 6px; color: var(--text2);"></div>
          </div>
          <div class="note-box">
            <div class="note-head"><span>Documentation Snippet</span> <button class="btn" id="btnCopy" style="padding: 2px 8px;">Copy</button></div>
            <pre id="notePreview"></pre>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const els = {
      btnToggleTime: document.getElementById('btnToggleTime'),
      timeSection: document.getElementById('timeSection'),
      mdmSection: document.getElementById('mdmSection'),
      tPrep: document.getElementById('tPrep'), tFace: document.getElementById('tFace'),
      tOrder: document.getElementById('tOrder'), tDoc: document.getElementById('tDoc'),
      totalTimeNum: document.getElementById('totalTimeNum'),
      p1: document.getElementById('p1'), p2: document.getElementById('p2'), p3: document.getElementById('p3'),
      r1: document.getElementById('r1'), r2: document.getElementById('r2'), r3: document.getElementById('r3'),
      suggestedCode: document.getElementById('suggestedCode'),
      codeReason: document.getElementById('codeReason'),
      notePreview: document.getElementById('notePreview'),
      btnCopy: document.getElementById('btnCopy'),
      btnTheme: document.getElementById('btnTheme')
    };

    let isTimeMode = false;

    // Time calculations based on PDF brackets
    function calculateTimeCode(total) {
      if (total >= 55) return { code: '99215 + 99417', text: '55+ mins requires prolonged service add-on.' };
      if (total >= 40) return { code: '99215', text: '40-54 minutes maps to 99215.' };
      if (total >= 30) return { code: '99214', text: '30-39 minutes maps to 99214.' };
      if (total >= 20) return { code: '99213', text: '20-29 minutes maps to 99213.' };
      if (total >= 10) return { code: '99212', text: '10-19 minutes maps to 99212.' };
      return { code: 'N/A', text: 'Less than 10 minutes cannot be billed using time.' };
    }

    // MDM calculations based on PDF 2-of-3 rules
    function calculateMDMCode() {
      let prob = 1; // minimal
      if (els.p2.checked || els.p3.checked) prob = 3; // moderate
      else if (els.p1.checked) prob = 2; // low

      let risk = 1; // minimal
      if (els.r1.checked || els.r2.checked) risk = 3; // moderate
      else if (els.r3.checked) risk = 2; // low

      // Simplified 2-of-3 assuming Data is minimal for this demo
      let mdmLevel = Math.max(Math.min(prob, risk), 1); 
      
      if (prob === 3 && risk === 3) return { code: '99214', text: 'MDM: Moderate (Moderate Problems + Moderate Risk)' };
      if (prob >= 2 && risk >= 2) return { code: '99213', text: 'MDM: Low (Low Problems + Low Risk)' };
      return { code: '99212', text: 'MDM: Straightforward' };
    }

    function generateNote() {
      if (isTimeMode) {
        const prep = parseInt(els.tPrep.value) || 0;
        const face = parseInt(els.tFace.value) || 0;
        const order = parseInt(els.tOrder.value) || 0;
        const doc = parseInt(els.tDoc.value) || 0;
        const total = prep + face + order + doc;
        
        els.totalTimeNum.textContent = total;
        const result = calculateTimeCode(total);
        els.suggestedCode.textContent = result.code;
        els.codeReason.textContent = "Based on total time: " + result.text;

        let note = `Time-Based Billing Breakdown (Total Time: ${total} minutes)\nThis level of service is based on total time spent by the provider on the calendar day of the encounter.\n\n`;
        if (prep > 0) note += `* ${prep} minutes: Preparing to see the patient, including review of prior records/tests.\n`;
        if (face > 0) note += `* ${face} minutes: Performing examination/evaluation and providing face-to-face counseling/education regarding treatment.\n`;
        if (order > 0) note += `* ${order} minutes: Ordering medications, tests, or procedures.\n`;
        if (doc > 0) note += `* ${doc} minutes: Documenting clinical information and care coordination.\n`;
        note += `\nTotal Provider Time: ${total} minutes.`;
        
        els.notePreview.textContent = note;

      } else {
        const result = calculateMDMCode();
        els.suggestedCode.textContent = result.code;
        els.codeReason.textContent = result.text;
        els.notePreview.textContent = "MDM Summary:\nThis level of service is based on Medical Decision Making.\n- Problems: " + (els.p2.checked || els.p3.checked ? "Moderate" : els.p1.checked ? "Low" : "Minimal") + "\n- Risk: " + (els.r1.checked || els.r2.checked ? "Moderate (Rx management/safety)" : els.r3.checked ? "Low" : "Minimal") + "\n\n(Note: If insurance audits require specific time itemizations, toggle to Time-Based Billing.)";
      }
    }

    els.btnToggleTime.addEventListener('click', () => {
      isTimeMode = !isTimeMode;
      els.timeSection.classList.toggle('active', isTimeMode);
      els.mdmSection.style.display = isTimeMode ? 'none' : 'block';
      els.btnToggleTime.textContent = isTimeMode ? 'Switch to MDM Billing' : 'Switch to Time-Based Billing';
      generateNote();
    });

    [els.tPrep, els.tFace, els.tOrder, els.tDoc, els.p1, els.p2, els.p3, els.r1, els.r2, els.r3].forEach(input => {
      input.addEventListener('input', generateNote);
    });

    els.btnCopy.addEventListener('click', () => {
      navigator.clipboard.writeText(els.notePreview.textContent);
      els.btnCopy.textContent = 'Copied!';
      setTimeout(() => els.btnCopy.textContent = 'Copy', 2000);
    });

    els.btnTheme.addEventListener('click', () => {
      const isLight = document.documentElement.getAttribute('data-theme') === 'light';
      document.documentElement.setAttribute('data-theme', isLight ? 'dark' : 'light');
    });

    generateNote(); // Init
  </script>
</body>
</html>
